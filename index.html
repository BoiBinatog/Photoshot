<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photobooth</title>
  <style>
  body {
  margin: 0;
  background: #2c2e46;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  justify-content: center;     
  align-items: center;         
  min-height: 100vh;           
}


.photobooth {
  display: flex;
  gap: 20px;
  align-items: center;
  justify-content: center;     
  width: 100%;
  max-width: 1400px;           
  margin: 0 auto;              
}


  video, canvas {
    width: auto;
    height: 80vh;
    background: black;
    border-radius: 25px;
    object-fit: cover;
    position: relative;
    transform: scaleX(-1);
  }

  /*setion-timer{
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 15px;
    background: rgba(0,0,0,0.7);
    color: white;
    border-radius: 6px;
    font-size: 18px;
    font-weight: bold;
    z-index: 9999;
  }*/


  #countdown {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 150px;
    color: white;
    font-weight: bold;
    text-shadow: 3px 3px 8px black;
    display: none;
    z-index: 10;
  }

  .strip-container {
  position: relative;
  width: 280px;     
  height: 650px;    
  display: flex;
  justify-content: center;
  border: none;
}


.photos img {
  position: absolute;
  width: 75%;
  height: 22%;  
  object-fit: cover;
  left: 12.5%;
  background: #111;
  border: none;  
  border-radius: 4px;
  z-index: 2;
}

#slot1 { top: 3%; }
#slot2 { top: 27%; }
#slot3 { top: 51%; }
#slot4 { top: 75%; }


  .controls {
    
    margin-right: 220px;
    display: flex;
    gap: 20px;
  }

  .controls button {
    padding: 10px 35px;
    border: none;
    border-radius: 30px;
    font-size: 18px;
    cursor: pointer;
    color: white;
    font-family: "Brush Script MT", cursive;  
  }
  .start {background: #70c5d3;}
  .print {background: #357388;}
  .restart {background: #d62828;}
  
  </style>
</head>
<body>
 <!-- <div id="session-timer" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 10px 15px;
  background: rgba(0,0,0,0.7);
  color: white;
  border-radius: 6px;
  font-size: 18px;
  font-weight: bold;
  z-index: 9999;">
</div> -->

  <div class="photobooth">
    <div class="preview" style="position:relative;">
      <video id="video" autoplay></video>
      <canvas id="canvas" width="700" height="500" hidden></canvas>
      <div id="countdown"></div>
    </div>
    
    
    <div class="strip-container">
      <div class="photos" id="photo-strip">
          <img id="slot1">
          <img id="slot2">
          <img id="slot3">
          <img id="slot4">
        </div>
      </div>
  </div>

  <div class="controls">
    <button class="start" onclick="startCapture()">Start</button>
    <button class="print" onclick="printStrip()">Save</button>
    <button class="restart" onclick="restartStrip()">Restart</button>
  </div>

  
  <canvas id="finalCanvas" width="1200" height="1800" hidden></canvas>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const finalCanvas = document.getElementById('finalCanvas');
    const fctx = finalCanvas.getContext('2d');
    const countdown = document.getElementById('countdown');
  
    let capturedImages = [];
  
    // aspect ratio
    navigator.mediaDevices.getUserMedia({
      video: {
        width: { ideal: 4096 }, 
        height: { ideal: 2160 }
      }
    })
    .then(stream => {
      video.srcObject = stream;
      video.onloadedmetadata = () => {
        console.log("Camera Resolution:", video.videoWidth, "x", video.videoHeight);
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
      };
    })
    .catch(err => console.error("Camera error:", err));

    // object-fit: cover
    function drawCover(ctx, img, dx, dy, dWidth, dHeight) {
      const imgRatio = img.width / img.height;
      const boxRatio = dWidth / dHeight;

      let sx, sy, sWidth, sHeight;

      if (imgRatio > boxRatio) {
        // crop sides
        sHeight = img.height;
        sWidth = sHeight * boxRatio;
        sx = (img.width - sWidth) / 2;
        sy = 0;
      } else {
        // crop top/bottom
        sWidth = img.width;
        sHeight = sWidth / boxRatio;
        sx = 0;
        sy = (img.height - sHeight) / 2;
      }

      ctx.drawImage(img, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);
    }
  
    function takePhoto() {
      ctx.save();
      ctx.translate(canvas.width, 0);
      ctx.scale(-1, 1);
  
      // Crop logic same as cover
      let frameW = canvas.width;
      let frameH = canvas.height;
      let frameRatio = frameW / frameH;
  
      let srcW = video.videoWidth;
      let srcH = video.videoHeight;
      let srcRatio = srcW / srcH;
  
      let sx, sy, sWidth, sHeight;
  
      if (srcRatio > frameRatio) {
        sHeight = srcH;
        sWidth = sHeight * frameRatio;
        sx = (srcW - sWidth) / 2;
        sy = 0;
      } else {
        sWidth = srcW;
        sHeight = sWidth / frameRatio;
        sx = 0;
        sy = (srcH - sHeight) / 2;
      }
  
      ctx.drawImage(video, sx, sy, sWidth, sHeight, 0, 0, frameW, frameH);
      ctx.restore();
  
      return canvas.toDataURL("image/png");
    }
  
    async function startCapture() {
      capturedImages = [];
      clearSlots();
      for (let i = 0; i < 4; i++) {
        await showCountdown(5); 
        let imgUrl = takePhoto();
        capturedImages.push(imgUrl);
        document.getElementById(`slot${i+1}`).src = imgUrl;
      }
    }
  
    function showCountdown(seconds) {
      return new Promise(resolve => {
        let counter = seconds;
        countdown.style.display = "block";
        countdown.textContent = counter;
  
        let interval = setInterval(() => {
          counter--;
          if (counter > 0) {
            countdown.textContent = counter;
          } else {
            clearInterval(interval);
            countdown.style.display = "none";
            resolve();
          }
        }, 1000);
      });
    }
  
function clearSlots() {
  for (let i = 1; i <= 4; i++) {
    document.getElementById(`slot${i}`).removeAttribute("src");
  }
}
  
function buildFinalStrip(callback) {
  // âœ” 5R print size (your modified orientation)
  const finalWidth = 1800;   
  const finalHeight = 1200;  

  finalCanvas.width = finalWidth;
  finalCanvas.height = finalHeight;

  // Load frame + icons first
  let frame = new Image();
  let icons = new Image();

  frame.src = "5rFrame.png";
  // icons.src = "5rIcons.png";

  let assetsLoaded = 0;
  function checkAssets() {
    assetsLoaded++;
    if (assetsLoaded === 2) drawPhotos();
  }

  frame.onload = checkAssets;
  icons.onload = checkAssets;

  // Draw everything only after assets load
  function drawPhotos() {
    // Draw frame BACKGROUND
    fctx.drawImage(frame, 0, 0, finalWidth, finalHeight);

    // SLOT SIZES
    const slot1W = 1005;
    const slot1H = 737;

    const slotW = 560;
    const slotH = 373;

    // SLOT POSITIONS
    const margin = 30;

    // Slot 1 = TOP RIGHT
    const slot1X = finalWidth - slot1W - margin;
    const slot1Y = margin;

    // Bottom row
    const bottomY = finalHeight - slotH - margin;

    const slot2X = margin;
    const slot3X = slot2X + slotW + margin;
    const slot4X = slot3X + slotW + margin;

    let loaded = 0;

    function place(src, x, y, w, h) {
      let img = new Image();
      img.src = src;
      img.onload = () => {
        drawCover(fctx, img, x, y, w, h);
        loaded++;
        if (loaded === 4) {
          // AFTER photos, draw icons overlay
          fctx.drawImage(icons, 0, 0, finalWidth, finalHeight);
          callback();
        }
      };
    }

    // Draw 4 photos
    place(capturedImages[0], slot1X, slot1Y, slot1W, slot1H);
    place(capturedImages[0], slot2X, bottomY, slotW, slotH);
    place(capturedImages[1], slot3X, bottomY, slotW, slotH);
    place(capturedImages[2], slot4X, bottomY, slotW, slotH);
  }
}


  
    function printStrip() {
      buildFinalStrip(() => {
        let dataUrl = finalCanvas.toDataURL("image/png");
        let link = document.createElement("a");
        link.download = "photobooth_strip.png";
        link.href = dataUrl;
        link.click();
      });
    }
  
    function restartStrip() {
      capturedImages = [];
      clearSlots();
    }
    /* 10-HOUR 
let HOURS = 10;  // you can change this anytime
let durationMS = HOURS * 60 * 60 * 1000;

let endTime = localStorage.getItem("boothEndTime");
const timerBox = document.getElementById("session-timer");

function startSessionTimer() {
  // If timer was never started, begin a new session
  if (!endTime) {
    endTime = Date.now() + durationMS;
    localStorage.setItem("boothEndTime", endTime);
  }
  runSessionTimer();
}

function runSessionTimer() {
  let timerInterval = setInterval(() => {
    const now = Date.now();
    let remaining = endTime - now;

    if (remaining <= 0) {
      clearInterval(timerInterval);
      localStorage.removeItem("boothEndTime");
      timerBox.textContent = "Session Expired";

      // LOCK THE BOOTH
      endBoothSession();
      return;
    }

    // Convert time
    let hours = Math.floor(remaining / (1000 * 60 * 60));
    let minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
    let seconds = Math.floor((remaining % (1000 * 60)) / 1000);

    timerBox.textContent = `${hours}h ${minutes}m ${seconds}s`;
  }, 1000);
}

function endBoothSession() {
  document.body.innerHTML = `
    <div style="font-size:45px; color:white; text-align:center; margin-top:20%;">
      SESSION TIME LIMIT REACHED
      <br><br>
      Please call the operator.
    </div>
  `;
}

// Start timer when the page loads
startSessionTimer(); */

  </script>
  
</body>
</html>
